LOC    OBJ              LINE   SOURCE
                        1      ; This part is nested within Rom bank D, responsibility is to adding the health upgrade to the characters.
------
                        2      ; This first block mostly overrides original code.
                        3      ; Override the maximum health of both characters (0xC0D9, 0xC0DE for X and Zero respectively)
036FFA EAD9C0           4      ; LD ($C0D9), A
036FFD EADEC0           5      ; LD ($C0DE), A
                        6      ; Check which character is active
037000 FAC9C0           7      ; LD A, ($C0C9)
037003 A7               8      ; AND A
037004 2009             9      ; JR NZ, +#9
                        10     ; First case: set the shadow value of X's health to the current health.
037006 FA84C0           11     ; LD A, ($C084)
037009 EAFEDF           12     ; LD ($DFFE), A
03700C 1804             13     ; JR, +#4
                        14     ; padding
03700E 00               15     ; NOP
                        16     ; Second case: call extra block to fix Zero's maximum health, if he picked the upgrade up.
03700F CDF17D           17     ; CALL $7DF1
------
                        18     ; This second block is an extra function needed to ensure Zero's health is corrected. 
                        19     ; This is 0x7DF1 at runtime; load Zero's current health and store it in the shadow value for Zero
037DF1 FA84C0           20     ; LD A, ($C084)
037DF4 EAFFDF           21     ; LD ($DFFF), A
037DF7 C9               22     ; RET
------
------
                        23     ; This part is in the Rom bank 2F, which overall handles the saving and loading of the SRAM.
------
                        24     ; 
0BE59A EAFEDF           25     ; LD ($DFFE), A
------
                        26     ; 
0BE5B2 EAFFDF           27     ; 
------
                        28     ; 
0BE618 CD387F           29     ; CALL $7F38
------
                        30     ; 
0BE7F9 CD6A7F           31     ; CALL $7F6A
0BE7FD FAFEDF           32     ; LD A, $DFFE
                        33     ; a small section of original code that shouldnt be overwritten and thus isnt in this patch file.
                        34     ; After resuming most code normally, filler is used and then the real (compatible) max health value is stored via register B.
0BE811 00               35     ; NOP
0BE812 00               36     ; NOP
0BE813 78               37     ; LD A, B
0BE814 FAFFDF           38     ; LD ($DFFF), A
------
                        39
                        40     ; 
0BFF38 FAFFDF           41     ; LD A, $DFFF
0BFF3B 47               42     ; LD B, A
0BFF3C FAFEDF           43     ; LD A, $DFFE
0BFF3F B8               44     ; CP B
0BFF40 3001                    ; JR NC, +#3
0BFF42 78                      ; LD A, B
0BFF43 EAD9C0                  ; LD $C0D9, A
0BFF46 EADEC0                  ; LD $C0DE, A
0BFF49 4F                      ; LD C, A
0BFF4A 0621                    ; LD B, 21
0BFF4C FAD5C0                  ; LD A, $C0D5
0BFF4F B8                      ; CP B
0BFF50 3007                    ; JR NC +#7
0BFF52 B9                      ; CP C
0BFF53 3004                    ; JR NC +#4
0BFF55 79                      ; LD A, C
0BFF56 EAD5C0                  ; LD $C0D5, A
0BFF59 FADAC0                  ; LD A, $C0DA
0BFF5C B8                      ; CP B
0BFF5D 3007                    ; JR NC +#7
0BFF5F B9                      ; CP C
0BFF60 3004                    ; JR NC +#4
0BFF62 79                      ; LD A, C
0BFF63 EADAC0                  ; LD $C0DA, A
0BFF66 CDA369                  ; CALL $69A3
0BFF69 C9                      ; RET
------

0BFF6A 0E21                    ; LD C, 0x21
0BFF6C FADAC0                  ; LD A, $C0DA
0BFF6F B9                      ; CP C
0BFF70 47                      ; LD B, A
0BFF71 FAFFDF                  ; LD A, $DFFF
0BFF74 3006                    ; JR NC +#6
0BFF76 B8                      ; CP B
0BFF77 3013                    ; JR NC +#19
0BFF79 47                      ; LD B, A
0BFF7A 1810                    ; JR +#16
0BFF7C 4F                      ; LD C, A
0BFF7D FADEC0                  ; LD A, $C0DE
0BFF80 91                      ; SUB C
0BFF81 4F                      ; LD C, A
0BFF82 FADEC0                  ; LD A, $C0DE
0BFF85 91                      ; SUB C
0BFF86 4F                      ; LD C, A
0BFF87 78                      ; LD A, B
0BFF88 90                      ; SUB B
0BFF89 47                      ; LD B, A
0BFF8A 0E21                    ; LD C, 0x21
0BFF8C FAD5C0                  ; LD A, $C0D5
0BFF8F B9                      ; CP C
0BFF90 300C                    ; JR NC +#12
0BFF92 4F                      ; LD C, A
0BFF93 FAFEDF                  ; LD A, $DFFE
0BFF96 B9                      ; CP C
0BFF97 300F                    ; JR NC +#15
0BFF99 FAD5C0                  ; LD A, $C0D5
0BFF9C 180A                    ; JR +#10
0BFF9E 4F                      ; LD C, A
0BFF9F FAD9C0                  ; LD A, $C0D9
0BFFA2 91                      ; SUB C
0BFFA3 4F                      ; LD C, A
0BFFA4 FAD5C0                  ; LD A, $C0D5
0BFFA7 91                      ; SUB C
0BFFA8 C9                      ; RET
